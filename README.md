# Задание 1 — найди ошибки

Код содержит ошибки разной степени критичности. Некоторые из них — стилистические, а другие — даже не позволят вам запустить приложение. Вам нужно найти все ошибки и исправить их.

Пункты для самопроверки:

1. Приложение должно успешно запускаться.
1. По адресу http://localhost:9000 должна открываться карта с метками.
1. Должна правильно работать вся функциональность, перечисленная в условиях задания.
1. Не должно быть лишнего кода.
1. Все должно быть в едином codestyle.

## Найденные ошибки

Проект не запускается, ок. Идем в index.html. Там подключается index.js, проверяем настройки webpack.config.js, все ок, идем в index.js, находим первую ошибку:
   
    1. В "src/index.js", line 1. - ошибка импорта initMap. 
       Как решить: добавить в файле "src/map.js" default в export, 
       т.к. это единственный экспорт, соответственно его можно сделать по умолчанию.

Ура, проект запущен! Но карты не видно( В инспекторе хрома замечаем, что у дива, на который вешается наша карта не задана высота. Исправляем:

    2. В "public/index.css" дописываем 
    
        #map {
          height: 100vh;
        }
Так, теперь видно, но нет геометок. Из src/index.js  идем в вызываемый InitMap и ковыряемся. Видно, что логика для объектов есть, но логики для их добавления на карту - нет. Исправляем:
    
    3. Добавим перед последней закрывающей фигурной скобкой в "src/map.js" на 54 строку:
    myMap.geoObjects.add(objectManager); 
    
Хмм, все равно не видно. По приходящим координатам должны быть в Москве...
А, перепутали порядок параметров широты и долготы.

    4. В "src/mappers.js" переписываем 11 строку:
       Было: coordinates: [obj.long, obj.lat]
       Стало: coordinates: [obj.lat, obj.long]

Ура! Дальше понимаем, что балун не раскрывается при нажатии на станцию.
Точнее раскрывается, пустой, не в том же месте, где станция и вылетает страшная ошибка в консоли. По тексту ошибки, отладчиком и интуицией понимаем, что проблема в "src/details.js" в методах build и clear, в которых идет обращение к this внутри стрелочной функции. А-та-та. Исправляем на обычную:

    5. В "src/details.js" переписываем 30 и 46 строки:
       Было: build: () => { 
       Cтало: build: function() {
       Аналогично с clear

Так. Теперь балуны в нужных местах и даже что-то показывают. Что-то не так с графиком. Идем править:
    
    6. В "src/chart.js" на строке 47 максимальное значение по оси ОХ = 0. Убираем это -_-
       Было: yAxes: [{ ticks: { beginAtZero: true, max: 0 } }]
       Стало: yAxes: [{ ticks: { beginAtZero: true} }]
       
       Заодно поправим импорт: уберем фигурные скобки в импорте, 
       т.к. в библиотеке Chart.js класс Chart экспортируется по умолчанию.

Теперь мы можем видеть красивый график нагрузки. Только, каждется в отображаемые данные закралась ошибочка: показатели отстают на час, хотя обновляются при новом часе. Давайте исправим:
    
    7. В "src/chart.js" на строке 11 добавим единицу.
       Было:  x.setHours(x.getHours() - data.length + i);
       Стало: x.setHours(x.getHours() - data.length + i + 1);
       
Теперь ок. Перекрасим кластер, если там есть неисправная станция. Готового кода нет, значит допишем сами:

    8. В "src/map.js" заменим:
    
           objectManager.clusters.options.set('preset', 'islands#greenClusterIcons');
       
       на:
       
           objectManager.clusters.events.add('add', function (e) {
               let cluster = objectManager.clusters.getById(e.get('objectId')),
                   objects = cluster.properties.geoObjects;
               if (objects.find(el => el.isActive === false)) {
                 objectManager.clusters.setClusterOptions(cluster.id, {
                   preset: 'islands#redClusterIcons'
                 });
               } else {
                 objectManager.clusters.setClusterOptions(cluster.id, {
                   preset: 'islands#greenClusterIcons'
                 });
               }
             });
             


 Завершающий шаг: причесать код на варнинги, неиспользуемый код, стилистические ошибки. Запускаем в Intellij IDEA статический анализатор кода, он находит незакрытые точки с запятой, вары, излишние локальные переменные и прочее. Все они исправлены в коммите "стилистические ошибки исправлены". + удален "src/popup.js" так как вместо него используется "src/details.js", в popup.js устаревшие поля и нет графиков.

 Готово!

